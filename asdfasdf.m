help=ComputeDetF(x)

function this_phi=ComputePhi(th,thd,thdd)
    this_phi = [(29471*thdd(1))/20000 + (49*thdd(1)*cos(2*th(2)))/80 + (49*thdd(1)*cos(2*th(2) + 2*th(3)))/200 + (259*thdd(1)*cos(th(2) + th(3)))/500 + (259*thdd(1)*cos(th(2)))/200 + (49*thdd(1)*cos(th(3)))/100 + (49*thdd(1)*cos(2*th(2) + th(3)))/100 - (259*thd(1)*thd(2)*sin(th(2) + th(3)))/500 - (259*thd(1)*thd(3)*sin(th(2) + th(3)))/500 - (259*thd(1)*thd(2)*sin(th(2)))/200 - (49*thd(1)*thd(3)*sin(th(3)))/100 - (49*thd(1)*thd(2)*sin(2*th(2) + th(3)))/50 - (49*thd(1)*thd(3)*sin(2*th(2) + th(3)))/100 - (49*thd(1)*thd(2)*sin(2*th(2)))/40 - (49*thd(1)*thd(2)*sin(2*th(2) + 2*th(3)))/100 - (49*thd(1)*thd(3)*sin(2*th(2) + 2*th(3)))/100,     0,             0,                     0, cos(th(2))*thd(2)^2 + thdd(2)*sin(th(2)), cos(th(2) + th(3))*thd(2)^2 + 2*cos(th(2) + th(3))*thd(2)*thd(3) + cos(th(2) + th(3))*thd(3)^2 + thdd(2)*sin(th(2) + th(3)) + thdd(3)*sin(th(2) + th(3)), cos(th(2) + th(3) + th(4))*thd(2)^2 + 2*cos(th(2) + th(3) + th(4))*thd(2)*thd(3) + 2*cos(th(2) + th(3) + th(4))*thd(2)*thd(4) + cos(th(2) + th(3) + th(4))*thd(3)^2 + 2*cos(th(2) + th(3) + th(4))*thd(3)*thd(4) + cos(th(2) + th(3) + th(4))*thd(4)^2 + thdd(2)*sin(th(2) + th(3) + th(4)) + thdd(3)*sin(th(2) + th(3) + th(4)) + thdd(4)*sin(th(2) + th(3) + th(4)), - sin(th(2))*thd(2)^2 + thdd(2)*cos(th(2)), - sin(th(2) + th(3))*thd(2)^2 - 2*sin(th(2) + th(3))*thd(2)*thd(3) - sin(th(2) + th(3))*thd(3)^2 + thdd(2)*cos(th(2) + th(3)) + thdd(3)*cos(th(2) + th(3)), - sin(th(2) + th(3) + th(4))*thd(2)^2 - 2*sin(th(2) + th(3) + th(4))*thd(2)*thd(3) - 2*sin(th(2) + th(3) + th(4))*thd(2)*thd(4) - sin(th(2) + th(3) + th(4))*thd(3)^2 - 2*sin(th(2) + th(3) + th(4))*thd(3)*thd(4) - sin(th(2) + th(3) + th(4))*thd(4)^2 + thdd(2)*cos(th(2) + th(3) + th(4)) + thdd(3)*cos(th(2) + th(3) + th(4)) + thdd(4)*cos(th(2) + th(3) + th(4)), thdd(1)/2 - (thdd(1)*cos(2*th(2)))/2 + thd(1)*thd(2)*sin(2*th(2)), thdd(1)/2 - (thdd(1)*cos(2*th(2) + 2*th(3)))/2 + thd(1)*thd(2)*sin(2*th(2) + 2*th(3)) + thd(1)*thd(3)*sin(2*th(2) + 2*th(3)), thdd(1)/2 - (thdd(1)*cos(2*th(2) + 2*th(3) + 2*th(4)))/2 + thd(1)*thd(2)*sin(2*th(2) + 2*th(3) + 2*th(4)) + thd(1)*thd(3)*sin(2*th(2) + 2*th(3) + 2*th(4)) + thd(1)*thd(4)*sin(2*th(2) + 2*th(3) + 2*th(4)), thdd(1)*sin(2*th(2)) + 2*thd(1)*thd(2)*cos(2*th(2)), thdd(1)*sin(2*th(2) + 2*th(3)) + 2*thd(1)*thd(2)*cos(2*th(2) + 2*th(3)) + 2*thd(1)*thd(3)*cos(2*th(2) + 2*th(3)), thdd(1)*sin(2*th(2) + 2*th(3) + 2*th(4)) + 2*thd(1)*thd(2)*cos(2*th(2) + 2*th(3) + 2*th(4)) + 2*thd(1)*thd(3)*cos(2*th(2) + 2*th(3) + 2*th(4)) + 2*thd(1)*thd(4)*cos(2*th(2) + 2*th(3) + 2*th(4)), thdd(1), thdd(1)/2 + (thdd(1)*cos(2*th(2)))/2 - thd(1)*thd(2)*sin(2*th(2)), thdd(1)/2 + (thdd(1)*cos(2*th(2) + 2*th(3)))/2 - thd(1)*thd(2)*sin(2*th(2) + 2*th(3)) - thd(1)*thd(3)*sin(2*th(2) + 2*th(3)), thdd(1)/2 + (thdd(1)*cos(2*th(2) + 2*th(3) + 2*th(4)))/2 - thd(1)*thd(2)*sin(2*th(2) + 2*th(3) + 2*th(4)) - thd(1)*thd(3)*sin(2*th(2) + 2*th(3) + 2*th(4)) - thd(1)*thd(4)*sin(2*th(2) + 2*th(3) + 2*th(4)), sign(thd(1)),          0,          0,          0, thd(1),    0,    0,    0, 10*thdd(1), - 8*cos(th(2))*thd(2)^2 - 8*thdd(2)*sin(th(2)), 8*thdd(1), - (21*thd(2)^2*cos(th(2)))/10 - (21*thdd(2)*sin(th(2)))/10, - 6*cos(th(2) + th(3))*thd(2)^2 - 12*cos(th(2) + th(3))*thd(2)*thd(3) - 6*cos(th(2) + th(3))*thd(3)^2 - 6*thdd(2)*sin(th(2) + th(3)) - 6*thdd(3)*sin(th(2) + th(3)), 6*thdd(1), - (7*thd(2)^2*cos(th(2)))/5 - (7*thdd(2)*sin(th(2) + th(3)))/5 - (7*thdd(3)*sin(th(2) + th(3)))/5 - (7*thdd(2)*sin(th(2)))/5 - (7*thd(2)^2*cos(th(2) + th(3)))/5 - (7*thd(3)^2*cos(th(2) + th(3)))/5 - (14*thd(2)*thd(3)*cos(th(2) + th(3)))/5, - 4*cos(th(2) + th(3) + th(4))*thd(2)^2 - 8*cos(th(2) + th(3) + th(4))*thd(2)*thd(3) - 8*cos(th(2) + th(3) + th(4))*thd(2)*thd(4) - 4*cos(th(2) + th(3) + th(4))*thd(3)^2 - 8*cos(th(2) + th(3) + th(4))*thd(3)*thd(4) - 4*cos(th(2) + th(3) + th(4))*thd(4)^2 - 4*thdd(2)*sin(th(2) + th(3) + th(4)) - 4*thdd(3)*sin(th(2) + th(3) + th(4)) - 4*thdd(4)*sin(th(2) + th(3) + th(4)), 4*thdd(1), 10*thdd(1), (74*thdd(1)*cos(th(2)))/25 - (74*thd(1)*thd(2)*sin(th(2)))/25, 4*thdd(1) + 4*thdd(1)*cos(2*th(2)) - 8*thd(1)*thd(2)*sin(2*th(2)), (111*thdd(1)*cos(th(2) + th(3)))/50 + (21*thdd(1)*cos(th(3)))/10 + (21*thdd(1)*cos(2*th(2) + th(3)))/10 - (111*thd(1)*thd(2)*sin(th(2) + th(3)))/50 - (111*thd(1)*thd(3)*sin(th(2) + th(3)))/50 - (21*thd(1)*thd(3)*sin(th(3)))/10 - (21*thd(1)*thd(2)*sin(2*th(2) + th(3)))/5 - (21*thd(1)*thd(3)*sin(2*th(2) + th(3)))/10, 3*thdd(1) + 3*thdd(1)*cos(2*th(2) + 2*th(3)) - 6*thd(1)*thd(2)*sin(2*th(2) + 2*th(3)) - 6*thd(1)*thd(3)*sin(2*th(2) + 2*th(3)), (7*thdd(1)*cos(2*th(2) + th(3) + th(4)))/5 + (7*thdd(1)*cos(th(3) + th(4)))/5 + (7*thdd(1)*cos(th(4)))/5 + (7*thdd(1)*cos(2*th(2) + 2*th(3) + th(4)))/5 + (37*thdd(1)*cos(th(2) + th(3) + th(4)))/25 - (7*thd(1)*thd(3)*sin(th(3) + th(4)))/5 - (7*thd(1)*thd(4)*sin(th(3) + th(4)))/5 - (7*thd(1)*thd(4)*sin(th(4)))/5 - (14*thd(1)*thd(2)*sin(2*th(2) + 2*th(3) + th(4)))/5 - (14*thd(1)*thd(3)*sin(2*th(2) + 2*th(3) + th(4)))/5 - (7*thd(1)*thd(4)*sin(2*th(2) + 2*th(3) + th(4)))/5 - (37*thd(1)*thd(2)*sin(th(2) + th(3) + th(4)))/25 - (37*thd(1)*thd(3)*sin(th(2) + th(3) + th(4)))/25 - (37*thd(1)*thd(4)*sin(th(2) + th(3) + th(4)))/25 - (14*thd(1)*thd(2)*sin(2*th(2) + th(3) + th(4)))/5 - (7*thd(1)*thd(3)*sin(2*th(2) + th(3) + th(4)))/5 - (7*thd(1)*thd(4)*sin(2*th(2) + th(3) + th(4)))/5, 2*thdd(1) + 2*thdd(1)*cos(2*th(2) + 2*th(3) + 2*th(4)) - 4*thd(1)*thd(2)*sin(2*th(2) + 2*th(3) + 2*th(4)) - 4*thd(1)*thd(3)*sin(2*th(2) + 2*th(3) + 2*th(4)) - 4*thd(1)*thd(4)*sin(2*th(2) + 2*th(3) + 2*th(4));
                                                                                                                                                                         (343*thdd(2))/200 + (49*thdd(3))/100 + (6867*cos(th(2) + th(3)))/2000 + (6867*cos(th(2)))/1000 + (259*thd(1)^2*sin(th(2)))/400 - (49*thd(3)^2*sin(th(3)))/100 + (49*thd(1)^2*sin(2*th(2) + th(3)))/100 + (49*thd(1)^2*sin(2*th(2)))/80 + (49*thdd(2)*cos(th(3)))/50 + (49*thdd(3)*cos(th(3)))/100 + (49*thd(1)^2*sin(2*th(2) + 2*th(3)))/200 + (259*thd(1)^2*sin(th(2) + th(3)))/1000 - (49*thd(2)*thd(3)*sin(th(3)))/50, thdd(2), thdd(2) + thdd(3), thdd(2) + thdd(3) + thdd(4),                   thdd(1)*sin(th(2)),                                                                                                     thdd(1)*sin(th(2) + th(3)),                                                                                                                                                                                                                                                              thdd(1)*sin(th(2) + th(3) + th(4)),                     thdd(1)*cos(th(2)),                                                                                                       thdd(1)*cos(th(2) + th(3)),                                                                                                                                                                                                                                                                thdd(1)*cos(th(2) + th(3) + th(4)),                                -(thd(1)^2*sin(2*th(2)))/2,                                                                       -(thd(1)^2*sin(2*th(2) + 2*th(3)))/2,                                                                                                                              -(thd(1)^2*sin(2*th(2) + 2*th(3) + 2*th(4)))/2,                        -thd(1)^2*cos(2*th(2)),                                                                 -thd(1)^2*cos(2*th(2) + 2*th(3)),                                                                                                                          -thd(1)^2*cos(2*th(2) + 2*th(3) + 2*th(4)),     0,                                 (thd(1)^2*sin(2*th(2)))/2,                                                                        (thd(1)^2*sin(2*th(2) + 2*th(3)))/2,                                                                                                                               (thd(1)^2*sin(2*th(2) + 2*th(3) + 2*th(4)))/2,          0, sign(thd(2)),          0,          0,    0, thd(2),    0,    0,        0,                      -8*thdd(1)*sin(th(2)),       0,                            -(21*thdd(1)*sin(th(2)))/10,                                                                                                             -6*thdd(1)*sin(th(2) + th(3)),       0,                                                                                                                                                    - (7*thdd(1)*sin(th(2) + th(3)))/5 - (7*thdd(1)*sin(th(2)))/5,                                                                                                                                                                                                                                                                         -4*thdd(1)*sin(th(2) + th(3) + th(4)),       0,        0,        (37*sin(th(2))*thd(1)^2)/25 + (981*cos(th(2)))/100,                         4*sin(2*th(2))*thd(1)^2 + 8*thdd(2),                                                                   (981*cos(th(2) + th(3)))/100 - (21*thd(3)^2*sin(th(3)))/10 + (21*thd(1)^2*sin(2*th(2) + th(3)))/10 + (21*thdd(2)*cos(th(3)))/5 + (21*thdd(3)*cos(th(3)))/10 + (111*thd(1)^2*sin(th(2) + th(3)))/100 - (21*thd(2)*thd(3)*sin(th(3)))/5,                                                        3*sin(2*th(2) + 2*th(3))*thd(1)^2 + 6*thdd(2) + 6*thdd(3),                                                                                       (981*cos(th(2) + th(3) + th(4)))/100 - (7*thd(4)^2*sin(th(4)))/5 + (7*thd(1)^2*sin(2*th(2) + 2*th(3) + th(4)))/5 + (37*thd(1)^2*sin(th(2) + th(3) + th(4)))/50 + (14*thdd(2)*cos(th(3) + th(4)))/5 + (7*thdd(3)*cos(th(3) + th(4)))/5 + (7*thdd(4)*cos(th(3) + th(4)))/5 + (14*thdd(2)*cos(th(4)))/5 + (14*thdd(3)*cos(th(4)))/5 + (7*thdd(4)*cos(th(4)))/5 + (7*thd(1)^2*sin(2*th(2) + th(3) + th(4)))/5 - (7*thd(3)^2*sin(th(3) + th(4)))/5 - (7*thd(4)^2*sin(th(3) + th(4)))/5 - (14*thd(2)*thd(3)*sin(th(3) + th(4)))/5 - (14*thd(2)*thd(4)*sin(th(3) + th(4)))/5 - (14*thd(3)*thd(4)*sin(th(3) + th(4)))/5 - (14*thd(2)*thd(4)*sin(th(4)))/5 - (14*thd(3)*thd(4)*sin(th(4)))/5,                                                                                                       2*sin(2*th(2) + 2*th(3) + 2*th(4))*thd(1)^2 + 4*thdd(2) + 4*thdd(3) + 4*thdd(4);
                                                                                                                                                                                                                                                                                    (49*thdd(2))/100 + (49*thdd(3))/100 + (6867*cos(th(2) + th(3)))/2000 + (49*thd(1)^2*sin(th(3)))/200 + (49*thd(2)^2*sin(th(3)))/100 + (49*thd(1)^2*sin(2*th(2) + th(3)))/200 + (49*thdd(2)*cos(th(3)))/100 + (49*thd(1)^2*sin(2*th(2) + 2*th(3)))/200 + (259*thd(1)^2*sin(th(2) + th(3)))/1000,     0, thdd(2) + thdd(3), thdd(2) + thdd(3) + thdd(4),                                0,                                                                                                     thdd(1)*sin(th(2) + th(3)),                                                                                                                                                                                                                                                              thdd(1)*sin(th(2) + th(3) + th(4)),                                  0,                                                                                                       thdd(1)*cos(th(2) + th(3)),                                                                                                                                                                                                                                                                thdd(1)*cos(th(2) + th(3) + th(4)),                                                     0,                                                                       -(thd(1)^2*sin(2*th(2) + 2*th(3)))/2,                                                                                                                              -(thd(1)^2*sin(2*th(2) + 2*th(3) + 2*th(4)))/2,                                         0,                                                                 -thd(1)^2*cos(2*th(2) + 2*th(3)),                                                                                                                          -thd(1)^2*cos(2*th(2) + 2*th(3) + 2*th(4)),     0,                                                     0,                                                                        (thd(1)^2*sin(2*th(2) + 2*th(3)))/2,                                                                                                                               (thd(1)^2*sin(2*th(2) + 2*th(3) + 2*th(4)))/2,          0,          0, sign(thd(3)),          0,    0,    0, thd(3),    0,        0,                                      0,       0,                                                  0,                                                                                                             -6*thdd(1)*sin(th(2) + th(3)),       0,                                                                                                                                                                            -(7*thdd(1)*sin(th(2) + th(3)))/5,                                                                                                                                                                                                                                                                         -4*thdd(1)*sin(th(2) + th(3) + th(4)),       0,        0,                                                   0,                                                     0,                                                                                             (981*cos(th(2) + th(3)))/100 + (21*thd(1)^2*sin(th(3)))/20 + (21*thd(2)^2*sin(th(3)))/10 + (21*thd(1)^2*sin(2*th(2) + th(3)))/20 + (21*thdd(2)*cos(th(3)))/10 + (111*thd(1)^2*sin(th(2) + th(3)))/100,                                                        3*sin(2*th(2) + 2*th(3))*thd(1)^2 + 6*thdd(2) + 6*thdd(3),                                                                                                                                                                                                                                                      (981*cos(th(2) + th(3) + th(4)))/100 - (7*thd(4)^2*sin(th(4)))/5 + (7*thd(1)^2*sin(2*th(2) + 2*th(3) + th(4)))/5 + (37*thd(1)^2*sin(th(2) + th(3) + th(4)))/50 + (7*thdd(2)*cos(th(3) + th(4)))/5 + (14*thdd(2)*cos(th(4)))/5 + (14*thdd(3)*cos(th(4)))/5 + (7*thdd(4)*cos(th(4)))/5 + (7*thd(1)^2*sin(2*th(2) + th(3) + th(4)))/10 + (7*thd(1)^2*sin(th(3) + th(4)))/10 + (7*thd(2)^2*sin(th(3) + th(4)))/5 - (14*thd(2)*thd(4)*sin(th(4)))/5 - (14*thd(3)*thd(4)*sin(th(4)))/5,                                                                                                       2*sin(2*th(2) + 2*th(3) + 2*th(4))*thd(1)^2 + 4*thdd(2) + 4*thdd(3) + 4*thdd(4);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          0,     0,             0, thdd(2) + thdd(3) + thdd(4),                                0,                                                                                                                        0,                                                                                                                                                                                                                                                              thdd(1)*sin(th(2) + th(3) + th(4)),                                  0,                                                                                                                          0,                                                                                                                                                                                                                                                                thdd(1)*cos(th(2) + th(3) + th(4)),                                                     0,                                                                                                    0,                                                                                                                              -(thd(1)^2*sin(2*th(2) + 2*th(3) + 2*th(4)))/2,                                         0,                                                                                          0,                                                                                                                          -thd(1)^2*cos(2*th(2) + 2*th(3) + 2*th(4)),     0,                                                     0,                                                                                                    0,                                                                                                                               (thd(1)^2*sin(2*th(2) + 2*th(3) + 2*th(4)))/2,          0,          0,          0, sign(thd(4)),    0,    0,    0, thd(4),        0,                                      0,       0,                                                  0,                                                                                                                                   0,       0,                                                                                                                                                                                                      0,                                                                                                                                                                                                                                                                         -4*thdd(1)*sin(th(2) + th(3) + th(4)),       0,        0,                                                   0,                                                     0,                                                                                                                                                                                                                                                                     0,                                                                                                      0,                                                                                                                                                                                                                                                         (981*cos(th(2) + th(3) + th(4)))/100 + (7*thd(1)^2*sin(th(4)))/10 + (7*thd(2)^2*sin(th(4)))/5 + (7*thd(3)^2*sin(th(4)))/5 + (7*thd(1)^2*sin(2*th(2) + 2*th(3) + th(4)))/10 + (37*thd(1)^2*sin(th(2) + th(3) + th(4)))/50 + (7*thdd(2)*cos(th(3) + th(4)))/5 + (7*thdd(2)*cos(th(4)))/5 + (7*thdd(3)*cos(th(4)))/5 + (7*thd(1)^2*sin(2*th(2) + th(3) + th(4)))/10 + (7*thd(1)^2*sin(th(3) + th(4)))/10 + (7*thd(2)^2*sin(th(3) + th(4)))/5 + (14*thd(2)*thd(3)*sin(th(4)))/5,                                                                                                       2*sin(2*th(2) + 2*th(3) + 2*th(4))*thd(1)^2 + 4*thdd(2) + 4*thdd(3) + 4*thdd(4)]; 
end

function det_cov=ComputeDetF(x)
    Tf=10; %end of sim (start of sim should always be t=0)
    dt=.01; %time step for recording joint state
    t=0:dt:Tf; %timesteps for changing torque
    
    js=[js(:,2:end-1);(js(:,3:end)-js(:,1:end-2))/(2*dt)];
    js=[js(:,2:end-1);(js(5:8,3:end)-js(5:8,1:end-2))/(2*dt)];
    DOF=4;
    F=[];
    for i=1:size(js,2)
        F=[F;ComputePhi(js(1:4,i),js(5:8,i),js(9:12,i))]; %We stack our phi's together to do least mean squares
    end
    
    det_cov=0;
end